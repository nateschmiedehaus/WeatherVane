(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[53],{9828:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/reports",function(){return a(9530)}])},5795:function(e,t,a){"use strict";a.d(t,{O:function(){return l}});var s=a(5893),r=a(7294),n=a(5201),c=a.n(n);function l(e){let{title:t="Data context",tags:a=[],warnings:n=[]}=e,l=(0,r.useId)();if(0===a.length&&0===n.length)return null;let i=n.some(e=>"string"==typeof e.severity&&"critical"===e.severity.toLowerCase()),d=e=>{let t="string"==typeof e?e.toLowerCase():"";return"critical"===t?c().warningCritical:"warning"===t?c().warningCaution:c().warningInfo};return(0,s.jsxs)("section",{className:"".concat(c().panel," ds-surface-panel"),"aria-labelledby":l,role:"region",children:[(0,s.jsxs)("div",{className:c().header,children:[(0,s.jsx)("h3",{id:l,className:"".concat(c().heading," ds-title"),children:t}),i&&(0,s.jsx)("span",{className:"ds-badge","data-tone":"critical",children:"Action needed"})]}),a.length>0&&(0,s.jsx)("p",{className:"".concat(c().tags," ds-caption"),children:a.join(", ")}),n.length>0&&(0,s.jsx)("ul",{className:c().warningList,"aria-live":"polite",children:n.map(e=>{var t;return(0,s.jsxs)("li",{className:"".concat(c().warningItem," ").concat(d(e.severity)),children:[(0,s.jsx)("strong",{className:"ds-caption",children:(null!==(t=e.severity)&&void 0!==t?t:"warning").toUpperCase()}),(0,s.jsx)("span",{className:"ds-body",children:e.message})]},e.code)})})]})}},918:function(e,t,a){"use strict";a.d(t,{P:function(){return i}});var s=a(5893),r=a(7294),n=function(){for(var e,t,a=0,s="",r=arguments.length;a<r;a++)(e=arguments[a])&&(t=function e(t){var a,s,r="";if("string"==typeof t||"number"==typeof t)r+=t;else if("object"==typeof t){if(Array.isArray(t)){var n=t.length;for(a=0;a<n;a++)t[a]&&(s=e(t[a]))&&(r&&(r+=" "),r+=s)}else for(s in t)t[s]&&(r&&(r+=" "),r+=s)}return r}(e))&&(s&&(s+=" "),s+=t);return s},c=a(1682),l=a.n(c);let i=(0,r.forwardRef)((e,t)=>{let{className:a,type:r,loading:c=!1,loadingText:i,disabled:d,children:o,...u}=e,h=!!c,_=h&&null!=i?i:o;return(0,s.jsx)("button",{...u,ref:t,type:null!=r?r:"button",className:n("ds-body-strong",l().retryButton,h&&l().retryButtonLoading,a),disabled:d||h,"data-loading":h||void 0,"aria-busy":!!h||void 0,children:h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{"aria-hidden":!0,className:l().retryButtonSpinner}),(0,s.jsx)("span",{className:l().retryButtonLabel,children:_})]}):_})});i.displayName="RetryButton"},9530:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return I}});var s,r,n=a(5893),c=a(7294),l=a(9008),i=a.n(l),d=a(1664),o=a.n(d),u=a(2570),h=a(5795),_=a(918),p=a(3562),m=a.n(p),x=a(6091);let v=new Intl.NumberFormat(void 0,{style:"currency",currency:"USD",maximumFractionDigits:0}),y=new Intl.NumberFormat(void 0,{style:"percent",maximumFractionDigits:1}),f=new Intl.NumberFormat(void 0,{style:"decimal",maximumFractionDigits:2});function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"usd";return Number.isFinite(e)?"usd"===t?v.format(e):"percent"===t?y.format(e/100):"multiple"===t?"".concat(f.format(e),"\xd7"):f.format(e):"—"}function j(e){return null!=e&&Number.isFinite(e)?y.format(e/100):"—"}function g(e){let t=new Date(e);return Number.isNaN(t.getTime())?e:new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}).format(t)}function N(e){return e.hero_tiles.map(e=>({id:e.id,label:e.label,valueLabel:b(e.value,e.unit),deltaLabel:function(e){if(null!==e.delta_value&&void 0!==e.delta_value){if("usd"===e.unit)return"".concat(e.delta_value>=0?"+":"-").concat(b(Math.abs(e.delta_value),"usd"));if("multiple"===e.unit)return"".concat(e.delta_value>=0?"+":"-").concat(f.format(Math.abs(e.delta_value)))}return null!==e.delta_pct&&void 0!==e.delta_pct?"".concat(e.delta_pct>=0?"+":"-").concat(j(Math.abs(e.delta_pct))):null}(e),narrative:e.narrative}))}function w(e){let t=b(e.spend,"usd"),a=b(e.expected_revenue,"usd");return"".concat(e.headline,": ").concat(e.weather_driver,". ").concat(t," → ").concat(a," with ").concat(e.confidence.toLowerCase()," confidence.")}function C(e){return e.map(e=>({dateLabel:g(e.date),spendLabel:b(e.recommended_spend,"usd"),weatherLabel:"".concat(f.format(e.weather_index)," index"),guardrailLabel:j(e.guardrail_score)}))}var L=a(3454);let S=null!==(s=L.env.NEXT_PUBLIC_TENANT_ID)&&void 0!==s?s:"demo-tenant",k=Number(null!==(r=L.env.NEXT_PUBLIC_PLAN_HORIZON)&&void 0!==r?r:"7");function I(){var e,t,a,s,r;let[l,d]=(0,c.useState)(null),[p,v]=(0,c.useState)(!0),[y,f]=(0,c.useState)(null),[j,L]=(0,c.useState)(0),[I,T]=(0,c.useState)("idle"),[E,D]=(0,c.useState)(null),R=(0,c.useMemo)(()=>l?function(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=[];s.push("Executive Weather Report — ".concat(g(e.generated_at)));let r="number"==typeof a.horizonDays?"".concat(a.horizonDays,"-day outlook"):"".concat(e.trend.cadence," cadence");s.push("Scope: ".concat(r)),s.push(""),s.push("Hero metrics:"),N(e).forEach(e=>{let t=e.deltaLabel?" (".concat(e.deltaLabel,")"):"";s.push("• ".concat(e.label,": ").concat(e.valueLabel).concat(t," — ").concat(e.narrative))});let n=function(e,t){if(!t)return e.narratives.slice(0,3);let a=e.narratives.find(e=>e.id===t);return a?[a,...e.narratives.filter(e=>e.id!==t).slice(0,2)]:e.narratives.slice(0,3)}(e,a.focusNarrativeId);return n.length&&(s.push(""),s.push("Storyline highlights:"),n.forEach(e=>{s.push("• ".concat(w(e)))})),a.includeTrend&&e.trend.points.length&&(s.push(""),s.push("Trend snapshot (spend \xb7 weather \xb7 guardrails):"),C(e.trend.points.slice(-3)).forEach(e=>{s.push("• ".concat(e.dateLabel," — ").concat(e.spendLabel,", ").concat(e.weatherLabel,", ").concat(e.guardrailLabel))})),s.push(""),s.push("Scheduler: ".concat(e.schedule.status.toUpperCase()," — ").concat(null!==(t=e.schedule.note)&&void 0!==t?t:"Ready to deliver weekly exports.")),s.push("Success spotlight: ".concat(e.success.headline," (").concat(b(e.success.metric_value,e.success.metric_unit),")")),s.push("CTA: ".concat(e.success.cta_label," → ").concat(e.success.cta_href)),s.join("\n")}(l,{includeTrend:!0,horizonDays:k,focusNarrativeId:null!=E?E:void 0}):"",[l,E]),B=l?N(l):[],U=l?C(l.trend.points):[],A=null!==(t=null==l?void 0:l.context_tags)&&void 0!==t?t:[],F=null!==(a=null==l?void 0:l.context_warnings)&&void 0!==a?a:[],O=(0,c.useCallback)(()=>{let e=!0;return v(!0),(0,x.RC)(S,k).then(t=>{e&&(d(t),f(null))}).catch(t=>{var a;e&&(f(null!==(a=t.message)&&void 0!==a?a:"Failed to load executive report"),d(null))}).finally(()=>{e&&v(!1)}),()=>{e=!1}},[]);(0,c.useEffect)(()=>O(),[O,j]);let G=(0,c.useCallback)(async()=>{if(R)try{let e="undefined"!=typeof navigator?navigator.clipboard:void 0;if(!(null==e?void 0:e.writeText))throw Error("Clipboard API unavailable");await e.writeText(R),T("copied")}catch(e){console.error("Failed to copy report briefing",e),T("error")}},[R]),H=(0,c.useCallback)(async()=>{await G()},[G]),M=(0,c.useCallback)(()=>{if(!R)return;let e=encodeURIComponent("WeatherVane executive weather report"),t=encodeURIComponent(R);window.location.href="mailto:?subject=".concat(e,"&body=").concat(t),T("email")},[R]),P=e=>{D(e.id),T("idle")},Z=(0,c.useMemo)(()=>{switch(I){case"copied":return"Briefing copied to clipboard.";case"email":return"Launching email composer with executive briefing.";case"error":return"Share failed. Use Cmd/Ctrl+C to copy manually.";default:return""}},[I]),X="error"===I?"critical":"idle"===I?"muted":"success",W=(null==l?void 0:l.generated_at)?g(l.generated_at):"—",V=(null==l?void 0:l.schedule.next_delivery_at)?g(l.schedule.next_delivery_at):"Not scheduled",z=(null==l?void 0:l.schedule.last_sent_at)?g(l.schedule.last_sent_at):"No deliveries yet";return(0,n.jsxs)(u.A,{children:[(0,n.jsx)(i(),{children:(0,n.jsx)("title",{children:"WeatherVane \xb7 Reports"})}),(0,n.jsxs)("div",{className:m().root,children:[(0,n.jsxs)("section",{className:m().header,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"ds-display-small",children:"Executive Reports"}),(0,n.jsx)("p",{className:"ds-body",children:"Story-driven spend narratives blending weather signals and finance outcomes. Share a memo-ready briefing in minutes with the confidence that guardrails stay intact."}),(0,n.jsx)("div",{className:m().heroTiles,children:B.map(e=>(0,n.jsxs)("article",{className:m().heroTile,children:[(0,n.jsxs)("header",{className:m().cardHeader,children:[(0,n.jsx)("h3",{className:"ds-title-small",children:e.label}),e.deltaLabel?(0,n.jsx)("span",{className:m().heroDelta,"aria-label":"".concat(e.label," delta"),children:e.deltaLabel}):null]}),(0,n.jsx)("p",{className:m().heroMetric,children:e.valueLabel}),(0,n.jsx)("p",{className:m().heroNarrative,children:e.narrative})]},e.id))}),(0,n.jsxs)("div",{className:m().shareActions,children:[(0,n.jsx)("button",{type:"button",onClick:M,disabled:!l,className:"ds-button","data-variant":"ghost",children:"Share via email"}),(0,n.jsx)("button",{type:"button",onClick:H,disabled:!l,className:"ds-button","data-variant":"secondary",children:"Copy for Slack"}),(0,n.jsx)("button",{type:"button",onClick:G,disabled:!l,className:"ds-button","data-variant":"primary","data-state":"copied"===I?"success":"error"===I?"error":void 0,children:"Copy executive briefing"}),(0,n.jsx)("span",{className:Z?"ds-status":"sr-only","data-tone":Z?X:void 0,role:"status","aria-live":"polite",children:Z||" "})]})]}),(0,n.jsx)("aside",{className:m().meta,children:(0,n.jsxs)("dl",{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("dt",{className:"ds-caption",children:"Generated"}),(0,n.jsx)("dd",{className:"ds-body-strong",children:W})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("dt",{className:"ds-caption",children:"Cadence"}),(0,n.jsx)("dd",{className:"ds-body-strong",children:null!==(s=null==l?void 0:l.trend.cadence)&&void 0!==s?s:"".concat(k,"-day")})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("dt",{className:"ds-caption",children:"Next delivery"}),(0,n.jsx)("dd",{className:"ds-body-strong",children:V})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("dt",{className:"ds-caption",children:"Recipients"}),(0,n.jsx)("dd",{className:"ds-body-strong",children:(null==l?void 0:null===(e=l.schedule.recipients)||void 0===e?void 0:e.length)?l.schedule.recipients.join(", "):"Not configured"})]})]})})]}),p&&(0,n.jsx)("p",{className:"".concat(m().status," ds-body"),role:"status","aria-live":"polite",children:"Loading executive report…"}),y&&(0,n.jsxs)("div",{className:m().error,role:"alert",children:[(0,n.jsx)("p",{className:"ds-body",children:y}),(0,n.jsx)(_.P,{onClick:()=>{L(e=>e+1)},children:"Retry loading report"})]}),!p&&!y&&l&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("section",{className:m().contextSection,children:(0,n.jsx)(h.O,{tags:A,warnings:F})}),(0,n.jsx)("section",{className:m().cards,children:l.narratives.length?l.narratives.map(e=>(0,n.jsxs)("article",{className:m().card,children:[(0,n.jsxs)("header",{className:m().cardHeader,children:[(0,n.jsx)("h3",{className:"ds-title-small",children:e.headline}),(0,n.jsxs)("span",{className:m().chip,"data-tone":e.confidence.toLowerCase(),children:[e.confidence," confidence"]})]}),(0,n.jsx)("p",{className:m().cardSummary,children:w(e)}),(0,n.jsxs)("dl",{className:"ds-metadata",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("dt",{children:"Spend"}),(0,n.jsx)("dd",{children:b(e.spend,"usd")})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("dt",{children:"Expected revenue"}),(0,n.jsx)("dd",{children:b(e.expected_revenue,"usd")})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("dt",{children:"Plan date"}),(0,n.jsx)("dd",{children:g(e.plan_date)})]})]}),(0,n.jsx)("button",{type:"button",onClick:()=>P(e),className:"ds-link",children:"Focus share on this narrative"})]},e.id)):(0,n.jsx)("p",{className:m().cardEmpty,children:"No narratives yet. Run ingest pipelines to populate spend stories."})}),(0,n.jsxs)("section",{className:m().trendSection,children:[(0,n.jsx)("h3",{className:"ds-title-small",children:"Trend explorer"}),U.length?(0,n.jsxs)("table",{className:m().trendTable,children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{scope:"col",children:"Date"}),(0,n.jsx)("th",{scope:"col",children:"Recommended spend"}),(0,n.jsx)("th",{scope:"col",children:"Weather index"}),(0,n.jsx)("th",{scope:"col",children:"Guardrail score"})]})}),(0,n.jsx)("tbody",{children:U.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:e.dateLabel}),(0,n.jsx)("td",{children:e.spendLabel}),(0,n.jsx)("td",{children:e.weatherLabel}),(0,n.jsx)("td",{children:e.guardrailLabel})]},e.dateLabel))})]}):(0,n.jsx)("p",{className:m().trendEmpty,children:"Trend data will appear after the first weekly refresh with live spend coverage."})]}),(0,n.jsxs)("section",{className:m().schedule,children:[(0,n.jsxs)("header",{className:m().cardHeader,children:[(0,n.jsx)("h3",{className:"ds-title-small",children:"Export scheduler"}),(0,n.jsx)("span",{className:m().scheduleStatus,"data-state":l.schedule.status,children:l.schedule.status.toUpperCase()})]}),(0,n.jsxs)("ul",{className:m().scheduleList,children:[(0,n.jsxs)("li",{children:["Cadence: ",l.schedule.cadence]}),(0,n.jsxs)("li",{children:["Delivery format: ",l.schedule.delivery_format.toUpperCase()]}),(0,n.jsxs)("li",{children:["Next delivery: ",V]}),(0,n.jsxs)("li",{children:["Last sent: ",z]})]}),(0,n.jsx)("p",{className:"ds-body",children:null!==(r=l.schedule.note)&&void 0!==r?r:"Weekly briefings are ready to send once recipients confirm."})]}),(0,n.jsxs)("section",{className:m().successCard,children:[(0,n.jsx)("h3",{className:"ds-title-small",children:"Success highlight"}),(0,n.jsx)("p",{className:"ds-body",children:l.success.summary}),(0,n.jsx)("span",{className:m().successMetric,children:b(l.success.metric_value,l.success.metric_unit)}),(0,n.jsx)("div",{className:m().successActions,children:(0,n.jsx)(o(),{href:l.success.cta_href,className:"ds-link",children:l.success.cta_label})})]})]})]})]})}},5201:function(e){e.exports={panel:"context-panel_panel___QoO_",header:"context-panel_header__5j9dX",heading:"context-panel_heading__XERy_",tags:"context-panel_tags__cmUxz",warningList:"context-panel_warningList__Pls7N",warningItem:"context-panel_warningItem__kOu5x",warningInfo:"context-panel_warningInfo__NqfqL",warningCaution:"context-panel_warningCaution__XpMI7",warningCritical:"context-panel_warningCritical__joYO7",assignmentTable:"context-panel_assignmentTable__PLb2G",assignmentHeader:"context-panel_assignmentHeader__au_cv",assignmentRow:"context-panel_assignmentRow__ceDZw",summaryCard:"context-panel_summaryCard__cjOQY",summaryHeader:"context-panel_summaryHeader__IV8pS",liftValue:"context-panel_liftValue__h99_6",summaryGrid:"context-panel_summaryGrid__c2EOC",summaryMeta:"context-panel_summaryMeta___j10H",keyStats:"context-panel_keyStats__h_eYX",bodyCopy:"context-panel_bodyCopy__GZgZ0"}},1682:function(e){e.exports={retryButton:"retry-button_retryButton__857bg",retryButtonLoading:"retry-button_retryButtonLoading__h_n3Q",retryButtonSpinner:"retry-button_retryButtonSpinner__jIZZ_","retry-button-spin":"retry-button_retry-button-spin__xpbOc",retryButtonLabel:"retry-button_retryButtonLabel__Tfn2J"}},3562:function(e){e.exports={root:"reports_root__PocOz",header:"reports_header__N9pox",meta:"reports_meta__LpkOs panel-surface_panelSurface__9kGI1",heroTiles:"reports_heroTiles__Vd7HX",heroTile:"reports_heroTile__4Yp3v panel-surface_panelSurface__9kGI1",heroMetric:"reports_heroMetric__nsDy9",heroDelta:"reports_heroDelta__JSSZr",heroNarrative:"reports_heroNarrative__P_Q3_",shareActions:"reports_shareActions__ByZsU",contextSection:"reports_contextSection__lLDKW",cards:"reports_cards__ZU7hU",card:"reports_card__KFDUd panel-surface_panelSurface__9kGI1",cardHeader:"reports_cardHeader__C8xRW",chip:"reports_chip__WdZAu",cardSummary:"reports_cardSummary__Cw3fp",trendSection:"reports_trendSection___SALQ",trendTable:"reports_trendTable__aqHh3",schedule:"reports_schedule__sfFOE panel-surface_panelSurface__9kGI1",scheduleList:"reports_scheduleList__9Un50",scheduleStatus:"reports_scheduleStatus__viDmD",successCard:"reports_successCard__gdGXG panel-surface_panelSurface__9kGI1",successMetric:"reports_successMetric__wCuat",successActions:"reports_successActions__IiG6r",status:"reports_status__w3ocK",error:"reports_error__ghZiK",trendEmpty:"reports_trendEmpty___mTOh",cardEmpty:"reports_cardEmpty__JhU6s"}}},function(e){e.O(0,[717,570,589,888,774,179],function(){return e(e.s=9828)}),_N_E=e.O()}]);