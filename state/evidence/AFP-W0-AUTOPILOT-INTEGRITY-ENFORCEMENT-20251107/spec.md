# SPEC - AFP-W0-AUTOPILOT-INTEGRITY-ENFORCEMENT-20251107

**Task:** Autopilot Integrity Enforcement - No Bypasses, Full Quality
**Created:** 2025-11-07T14:20:00Z
**Phase:** SPEC

## Acceptance Criteria

### Must Have (Critical)

**1. All Bypass Code Removed**
- [ ] REVIEW task bypass removed from autonomous_runner.ts (lines 249-276)
- [ ] No task completion without full AFP lifecycle execution
- [ ] No shortcuts or fake completions in codebase
- [ ] Code review confirms zero bypass patterns remain

**2. Real MCP Integration Working**
- [ ] RealMCPClient connects successfully (no connection failures)
- [ ] AI reasoning via MCP (not template fallback)
- [ ] Evidence generated by actual LLM, not templates
- [ ] MCP integration tests pass

**3. All 5 Quality Critics Enforced**
- [ ] StrategyReviewer runs on every task
- [ ] ThinkingCritic runs on every task
- [ ] DesignReviewer runs on every task
- [ ] TestsCritic runs on every task
- [ ] ProcessCritic runs on every task
- [ ] Task cannot complete until ALL critics approve

**4. GATE Phase Enforced**
- [ ] design.md required before IMPLEMENT
- [ ] DesignReviewer must approve (score ≥95, zero critical violations)
- [ ] Task blocked in THINK phase until GATE passes

**5. Live-Fire Validation Proof**
- [ ] 1 complete task executed end-to-end
- [ ] All 10 AFP phases completed for validation task
- [ ] All critics approved for validation task
- [ ] Evidence bundle complete (strategy.md, spec.md, plan.md, think.md, design.md, implement.md, verify.md, review.md)
- [ ] Git commit created and pushed
- [ ] Quality score ≥95/100 documented

### Should Have (Important)

**6. Pre-commit Hook Enforcement**
- [ ] Hooks detect and block bypass attempts
- [ ] ProcessCritic fails commits with missing tests
- [ ] Autopilot changes require plan.md updates

**7. Git Integration Required**
- [ ] Every completed task creates git commit
- [ ] Commit includes AFP task ID
- [ ] Changes pushed to GitHub
- [ ] No local-only completions

**8. Monitoring & Telemetry**
- [ ] Quality scores logged for each task
- [ ] Critic approvals tracked
- [ ] Bypass attempts detected and logged
- [ ] Dashboard shows real vs fake completions

### Could Have (Nice to Have)

**9. Documentation Updates**
- [ ] AUTOPILOT_VALIDATION_RULES.md updated with new enforcement
- [ ] Examples of correct vs incorrect task completion
- [ ] Troubleshooting guide for MCP issues

**10. Automated Testing**
- [ ] Integration tests for full task lifecycle
- [ ] Tests verify critics run
- [ ] Tests verify bypass detection
- [ ] CI enforces quality standards

## Functional Requirements

### FR1: Task Execution Without Bypasses
**Given** a task in the roadmap
**When** the autonomous runner processes it
**Then** it must complete all 10 AFP phases with real AI reasoning
**And** all 5 critics must approve
**And** evidence must prove quality (not templates)

### FR2: MCP Integration
**Given** a task requiring AI reasoning
**When** the autonomous runner executes it
**Then** RealMCPClient must connect successfully
**And** evidence must be generated via MCP (not templates)
**Or** the task must fail with clear MCP error (not silently fall back to templates)

### FR3: Quality Critic Enforcement
**Given** a completed AFP phase (STRATEGIZE, THINK, GATE)
**When** the phase completes
**Then** the corresponding critic must run (StrategyReviewer, ThinkingCritic, DesignReviewer)
**And** the critic must approve before proceeding
**Or** the task must be marked as blocked with critic feedback

### FR4: GATE Phase Requirement
**Given** a task ready for IMPLEMENT phase
**When** the task attempts to proceed to IMPLEMENT
**Then** design.md must exist
**And** DesignReviewer must have approved it
**And** score must be ≥95 with zero critical violations
**Or** the task must remain in THINK phase

### FR5: Git Commit Requirement
**Given** a task marked as completed
**When** verifying completion
**Then** a git commit must exist with the task ID
**And** the commit must be pushed to GitHub
**Or** the task is NOT considered complete

## Non-Functional Requirements

### NFR1: Performance
- Task execution may be slower (15-30 min vs 0.5 sec)
- This is acceptable - quality over speed
- Target: 1-2 tasks completed per hour with full quality

### NFR2: Reliability
- Zero false positives (tasks wrongly marked complete)
- Zero silent failures (fallback to templates without error)
- All failures must be visible and actionable

### NFR3: Maintainability
- No complex bypass detection logic
- Simple enforcement: run critics, check results, block if failed
- Clear error messages when quality checks fail

### NFR4: Security
- No bypassing of quality gates
- Pre-commit hooks cannot be disabled without explicit flag
- Audit trail of all quality decisions

## Success Metrics

### Quantitative

1. **Completion Quality**
   - Before: 0% of "completed" tasks meet quality standards
   - After: 100% of "completed" tasks meet quality standards

2. **Critic Enforcement**
   - Before: 0/5 critics run on completed tasks
   - After: 5/5 critics run and approve on completed tasks

3. **Evidence Quality**
   - Before: Template-generated (score: 0/100)
   - After: AI-generated (score: ≥95/100)

4. **Git Integration**
   - Before: 0 commits for 25 "completed" tasks
   - After: 1 commit per completed task

5. **MCP Integration**
   - Before: Connection fails, falls back to templates
   - After: Connection succeeds, real AI reasoning

### Qualitative

1. **User Satisfaction**
   - Before: "completely useless"
   - After: "highest order specifications of quality control" (user's requirement)

2. **System Integrity**
   - Before: Bypasses everywhere, compliance theater
   - After: Zero tolerance, real quality enforcement

3. **Agent Behavior**
   - Before: Agents can skip work and mark tasks done
   - After: Agents cannot proceed without passing quality gates

## Definition of Done

A task is **DONE** when ALL of these are true:

1. ✅ All 10 AFP phases completed
2. ✅ All 5 critics approved (StrategyReviewer, ThinkingCritic, DesignReviewer, TestsCritic, ProcessCritic)
3. ✅ GATE passed (design.md exists, DesignReviewer approved, score ≥95)
4. ✅ Real AI reasoning used (MCP integration working, no template fallback)
5. ✅ Tests written and passing (if code task)
6. ✅ Git commit created with task ID
7. ✅ Changes pushed to GitHub
8. ✅ Evidence bundle complete and proves quality
9. ✅ Live-fire validation successful (for autopilot changes)
10. ✅ No bypass code in implementation

**If even ONE criterion is not met → Task is NOT done.**

## Out of Scope

**Not included in this task:**
- Improving MCP performance (separate task)
- Adding new critics beyond the existing 5
- Optimizing task execution speed (quality first)
- Fixing all existing fake completions (separate cleanup task)
- Wave 0.2 or beyond (this is Wave 0.1 fix only)

## Dependencies

**Required before this task can complete:**
1. MCP server must be accessible
2. All 5 critics must be functional
3. Pre-commit hooks must be installed
4. Git repository must exist
5. Roadmap must have at least 1 task for validation

## Risks

1. **MCP connection may fail** → Must fix MCP before claiming task done
2. **Some tasks may not pass critics** → Expected, that's the system working
3. **Slower completions** → Acceptable, documented in NFR1
4. **Resistance to enforcement** → CLAUDE.md and AGENTS.md mandate compliance

---
Generated: 2025-11-07T14:20:00Z
Phase: SPEC
Task: AFP-W0-AUTOPILOT-INTEGRITY-ENFORCEMENT-20251107
Status: Complete
