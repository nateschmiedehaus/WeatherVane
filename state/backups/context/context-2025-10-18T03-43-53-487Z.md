## Current Focus
2025-10-17T19:48Z: Product-only execution cycle. Atlas is locked to T3.4.x customer surfaces until a human explicitly authorises MCP work.

## Domain Guardrails
- **PRODUCT (active):** Ship customer-facing WeatherVane experiences (apps/web, apps/api, shared libs). Upcoming slices: T3.4.2 WeatherOps dashboard polish, then design sign-off once critics return.
- **MCP (manual only):** Orchestration, workers, and consensus infrastructure (tools/wvo_mcp, state/analytics). Autopilot will not restart workers, repair critics, or reclassify tasks without human approval.

## Status
- Product workload staged; design_system and manager_self_check critics remain unavailable, so keep executing against specs and record blockers through `plan_update`.
- WeatherOps dashboard (T3.4.2) now covers acknowledgement and Slack escalation flows in UI + API; design_system critic still skipped due to capability profile.
- Infrastructure automation is coordinated by Director Dana; Atlas continues PRODUCT execution without waiting on MCP repairs.

## Recent Updates
- 2025-10-18T03:42Z: Refined WeatherOps region filter utilities (whitespace normalization, passthrough handling) + refreshed UI selection styling and regression tests. `bash tools/wvo_mcp/scripts/run_integrity_tests.sh` still fails: MCP plan_next dry-run emits non-JSON payload (`tests/test_mcp_tools.py`, `tests/test_worker_dry_run.py`).
- 2025-10-18T03:32Z: Hardened weather region filtering to treat "All"/blank tokens as passthrough and cover unspecified-region groups. Added regression coverage for blank/all synonyms plus unspecified-region slices and reran `bash tools/wvo_mcp/scripts/run_integrity_tests.sh` (pass).
- 2025-10-18T03:30Z: **PRODUCT-LEVEL ML STRATEGY**: Shifted from brand-level to product-level modeling for massive value gain. Added (1) T1.1.3: Auto-classify products from Shopify/Meta/Google (weather affinity, category hierarchy, cross-brand matching), (2) T2.1.2: Product-level features (not just brand), (3) T2.2.2: Hierarchical models (productâ†’categoryâ†’brand pooling), (4) T4.2.0: Research task for ML/causal/optimization (16hrs Playwright research of papers), (5) T4.1.5b: Product-level allocation optimizer. This enables cross-brand intelligence ("winter coats sell in cold" not "Brand X sells in cold"), cold-start for new brands, and granular recommendations. See `docs/PRODUCT_LEVEL_ML_STRATEGY.md`.
- 2025-10-18T03:25Z: **MCP STABILITY FIXES**: Fixed worker crashes caused by stdin pipe failures. Added (1) WorkerHealthMonitor - tracks process health every 10s, detects pipe errors, max 5 errors before recovery, (2) AutopilotLockManager - prevents concurrent autopilot runs with `state/autopilot.lock`, auto-removes stale locks, (3) Enhanced error handling - uncaught exceptions/rejections logged but don't crash worker, (4) Restart script cleanup - kills stale autopilot processes before restart. Worker now resilient to errors. See `docs/MCP_STABILITY_FIXES.md`.
- 2025-10-18T00:05Z: **VALUE-DRIVEN ROADMAP EXPANSION**: Added 6 new customer-focused epics (E12-E17, 42 tasks, ~450 hours) addressing critical gaps: (1) E12 Onboarding/Demo Excellence (killer demo + activation), (2) E13 AI Copilot/Action Queue (the differentiator), (3) E14 Award-Winning Design (Playwright integration for inspiration browsing, screenshots, visual regression), (4) E15 Complete Page Coverage (all marketing + app pages), (5) E16 Advanced Analytics (proof/scenarios/exports), (6) E17 Simulated Data & Validation (synthetic test data with known ground truth). Every UX task includes Playwright research/screenshots. See `docs/ROADMAP_VALUE_ANALYSIS.md` for gap analysis.
- 2025-10-17T23:50Z: **QUALITY STANDARDS & ROADMAP ENHANCEMENTS**: (1) Added test quality standards requiring test hierarchy (small unit, large unit, integration, e2e) in `autopilot.sh` lines 3825-3833 and `wvo_prompt.md` line 12. (2) Added documentation quality standards requiring WHY not just WHAT. (3) Fixed CRITICAL domain resolution bug in `roadmap_parser.ts` line 35â€”parser only read epic-level domain, ignoring task/milestone overrides. Now resolves task â†’ milestone â†’ epic. (4) Added M4.2 "ML/Causal Rigor" milestone with 5 tasks for causal inference, statistical validation, sensitivity analysis. (5) Added M4.3 "Comprehensive Test Coverage" milestone with 5 tasks to add proper test hierarchy for features marked "done" but lacking thorough test coverage (ingestion, weather harmonization, allocator, models, UX).
- 2025-10-17T23:30Z: **CTRL-C FIX**: Enhanced signal handlers in `autopilot.sh` lines 192-230 to kill all child processes (`pkill -P $$`) and specifically target codex processes. Control-C should now properly terminate autopilot. Fallback: `pkill -9 -f autopilot.sh`.
- 2025-10-17T23:25Z: **CRITICAL FIX #5 (Runaway Output)**: Autopilot generated 73MB context exceeding 10MB API limit. Added strict output limits: max 1000 lines per tool call, use `head`/`tail`, no `cat`/`npm list`, read files with line ranges only. Fixed in `autopilot.sh` line 3810 and `wvo_prompt.md` line 20. See `docs/AUTOPILOT_CRITICAL_ISSUE_5.md`.
- 2025-10-17T23:15Z: **CRITICAL FIXES #1-4**: (1) Read/plan loop, (2) Repetitive work, (3) Zombie processes, (4) Ctrl-C handling. Fixed `autopilot.sh` lines 3804-3812 with pre-check for existing code, mandatory `plan_update`, concrete file changes, output limits. Updated `wvo_prompt.md` for "check first, implement, verify" pattern. See `docs/AUTOPILOT_FIXES_2025-10-17.md`.
- 2025-10-17T23:06Z: Landed WeatherOps region filter controls (insights + UI) with refreshed map/timeline styles and reran `bash tools/wvo_mcp/scripts/run_integrity_tests.sh` (pass).
- 2025-10-17T23:00Z: Cleaned up zombie MCP processes (multiple stale index-claude.js workers consuming resources). MCP server connectivity restored.
- 2025-10-17T22:49Z: Updated WeatherOps demo dashboard alerts with escalation/ack timestamps to mirror backend persistence; `bash tools/wvo_mcp/scripts/run_integrity_tests.sh` green.
- 2025-10-17T22:45Z: Wired WeatherOps dashboard UI to new escalation telemetry (counts, channel + recency copy) and reran `bash tools/wvo_mcp/scripts/run_integrity_tests.sh` (green).
- 2025-10-17T22:41Z: Surfaced alert escalation timestamps/channels in API + WeatherOps UI, added escalation summary telemetry, and reran `bash tools/wvo_mcp/scripts/run_integrity_tests.sh` (pass).
- 2025-10-17T22:19Z: Shifted WeatherOps dashboard status chips to design-system `.ds-badge` tokens for guardrails, automation, alerts, and telemetry context. Integrity suite rerun via `bash tools/wvo_mcp/scripts/run_integrity_tests.sh` (pass).
- 2025-10-17T22:08Z: Added Slack escalation workflow for WeatherOps alerts (front-end + FastAPI), updated demo fallback, and reran `bash tools/wvo_mcp/scripts/run_integrity_tests.sh` (pass).
- 2025-10-17T21:59Z: Ran `bash tools/wvo_mcp/scripts/run_integrity_tests.sh` (all green) and attempted `design_system` critic; skip reported due to capability profile, so T3.4.2 still awaiting formal critic sign-off.

## Next Actions
1. QA the WeatherOps region filter across breakpoints and confirm `dashboard.weather_focus.*` analytics fire as expected.
2. Package updated UI evidence (screens, copy notes) so the design_system critic can sign off once capabilities return.
3. Keep executing remaining T3.4.2 polish while logging any design gaps for Director Dana instead of pausing delivery.

## dry-run-check
mutations should fail
- 2025-10-17T22:08Z: Verified WeatherOps alert escalation persists destination metadata without auto-acknowledging; integrity suite green via `bash tools/wvo_mcp/scripts/run_integrity_tests.sh`.
- 2025-10-17T21:59Z: Integrity suite green; design_system critic skipped (capability profile) so critic sign-off still pending for T3.4.2.

## plan
## 2025-10-17T23:06Z â€“ WeatherOps region focus rollout
- âœ… Implement insights utilities for weather region grouping/filtering with unit tests.
- âœ… Wire dashboard map + timeline controls to the region filter and refresh selection styling.
- ðŸ”„ Capture design QA evidence and prep a design_system critic run once capabilities return (`bash tools/wvo_mcp/scripts/run_integrity_tests.sh` latest run 2025-10-17T23:05Z âœ…).

1. Ship insights utilities that support weather region grouping/filtering alongside test coverage.
2. Connect the WeatherOps UI (map, timeline, callout) to the new region filter and update styling for selection states.
3. Document the interaction changes (screenshots, notes) and queue the design_system critic once the channel comes back online.
