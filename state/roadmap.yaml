epics:
- id: E-GENERAL
  title: E-GENERAL
  status: pending
  domain: product
  milestones:
  - id: E-GENERAL-backlog
    title: Backlog
    status: pending
    tasks:
    - id: CRIT-PERF-ALLOCATOR-bc8604
      title: '[Critic:allocator] Restore performance'
      status: pending
      dependencies: []
      exit_criteria: []
      domain: product
      description: 'Critic allocator is underperforming and needs immediate remediation.


        Identity: Allocator Sentinel (operations, authority advisory)

        Mission: Ensure planner allocation and task routing stay optimal.

        Signature powers: Diagnoses misrouted tasks and capacity imbalances.; Suggests
        rebalancing across agents and squads.

        Autonomy guidance: Auto-adjust planner weights when safe; escalate persistent
        misallocations to Autopilot.


        Critic allocator failed 8 of the last 10 runs with 0 consecutive failures.


        Observation window: 10 runs


        Consecutive failures: 0


        Failures: 8 | Successes: 2


        Assigned to: Autopilot


        Expectations:

        - Diagnose root causes for the critic''s repeated failures.

        - Patch critic configuration, training data, or underlying automation as needed.

        - Document findings in state/context.md and roadmap notes.

        - Close this task once the critic passes reliably.


        Latest output snippet:

        ============================= test session starts ==============================

        platform darwin -- Python 3.10.12, pytest-8.4.2, pluggy-1.6.0

        rootdir: /Volumes/BigSSD4/nathanielschmiedehaus/Documents/WeatherVane

        configfile: pyproject.toml

        plugins: anyio-3.7.1, asyncio-1.2.0

        asyncio: mode=strict, debug=False, asyncio_default_fixture_loop_scope=None,
        asyncio_default_test_loop_scope=function

        collected 5 items


        tests/test_allocator_routes.py ..                                        [
        40%]

        tests/test_creative_route.py .                                           [
        60%]

        tests/apps/model/test_cre...'
    - id: CRIT-PERF-BUILD-958e1f
      title: '[Critic:build] Restore performance'
      status: pending
      dependencies: []
      exit_criteria: []
      domain: product
      description: "Critic build is underperforming and needs immediate remediation.\n\
        \nIdentity: Build Sentinel (engineering, authority blocking)\nMission: Guarantee\
        \ that core build processes remain reproducible and optimized across environments.\n\
        Signature powers: Diagnoses build pipeline regressions and unstable toolchains.;\
        \ Flags missing build artifacts or misconfigured dependencies before release.\n\
        Autonomy guidance: Attempt automated patching of build scripts when safe;\
        \ escalate infrastructure escalations beyond local fixes.\n\nCritic build\
        \ failed 5 of the last 6 runs with 0 consecutive failures.\n\nObservation\
        \ window: 6 runs\n\nConsecutive failures: 0\n\nFailures: 5 | Successes: 1\n\
        \nAssigned to: Autopilot\n\nExpectations:\n- Diagnose root causes for the\
        \ critic's repeated failures.\n- Patch critic configuration, training data,\
        \ or underlying automation as needed.\n- Document findings in state/context.md\
        \ and roadmap notes.\n- Close this task once the critic passes reliably.\n\
        \nLatest output snippet:\nwarning: The top-level linter settings are deprecated\
        \ in favour of their counterparts in the `lint` section. Please update the\
        \ following options in `pyproject.toml`:\n  - 'select' -> 'lint.select'"
    - id: CRIT-PERF-DESIGNSYSTEM-1a886a
      title: '[Critic:designsystem] Restore performance'
      status: pending
      dependencies: []
      exit_criteria: []
      domain: product
      description: 'Critic designsystem is underperforming and needs immediate remediation.


        Identity: Design System (design_system, authority advisory)

        Mission: Safeguard design_system discipline.

        Signature powers: Reports on findings when configuration is missing.


        No successful runs recorded in the last 9 observations; 5 consecutive failures
        detected.


        Observation window: 9 runs


        Consecutive failures: 5


        Failures: 6 | Successes: 3


        Assigned to: Director Dana


        Expectations:

        - Diagnose root causes for the critic''s repeated failures.

        - Patch critic configuration, training data, or underlying automation as needed.

        - Document findings in state/context.md and roadmap notes.

        - Close this task once the critic passes reliably.


        Latest output snippet:

        ./src/pages/dashboard.tsx

        968:14  Error: Parsing error: '')'' expected.


        info  - Need to disable some ESLint rules? Learn more here: https://nextjs.org/docs/basic-features/eslint#disabling-rules'
    - id: CRIT-PERF-EXECREVIEW-ef2384
      title: '[Critic:execreview] Restore performance'
      status: pending
      dependencies: []
      exit_criteria: []
      domain: product
      description: 'Critic execreview is underperforming and needs immediate remediation.


        Identity: Exec Review (exec_review, authority advisory)

        Mission: Safeguard exec_review discipline.

        Signature powers: Reports on findings when configuration is missing.


        No successful runs recorded in the last 12 observations; 12 consecutive failures
        detected.


        Observation window: 12 runs


        Consecutive failures: 12


        Failures: 12 | Successes: 0


        Assigned to: Director Dana


        Expectations:

        - Diagnose root causes for the critic''s repeated failures.

        - Patch critic configuration, training data, or underlying automation as needed.

        - Document findings in state/context.md and roadmap notes.

        - Close this task once the critic passes reliably.


        Latest output snippet:

        skipped due to capability profile'
    - id: CRIT-PERF-GLOBAL-9882b7
      title: '[Critics] Systemic performance remediation'
      status: pending
      dependencies: []
      exit_criteria: []
      domain: product
      description: 'Multiple critics are underperforming and require coordinated intervention.


        3 critics require director-level intervention after repeated failures.


        Affected critics: execreview, integrationfury, managerselfcheck


        Critics evaluated in run: 5


        Reports captured: 3


        Assigned to: Director Dana


        Expectations:

        - Review individual remediation tasks and look for systemic issues.

        - Adjust critic configurations, training loops, or staffing mixes.

        - Provide a coordination brief in state/context.md.

        - Close this systemic task once individual critics are back on track.'
    - id: CRIT-PERF-HEALTHCHECK-0e6b67
      title: '[Critic:healthcheck] Restore performance'
      status: pending
      dependencies: []
      exit_criteria: []
      domain: product
      description: "Critic healthcheck is underperforming and needs immediate remediation.\n\
        \nIdentity: Health Check (health_check, authority advisory)\nMission: Safeguard\
        \ health_check discipline.\nSignature powers: Reports on findings when configuration\
        \ is missing.\n\nCritic healthcheck failed 4 of the last 5 runs with 0 consecutive\
        \ failures.\n\nObservation window: 5 runs\n\nConsecutive failures: 0\n\nFailures:\
        \ 4 | Successes: 1\n\nAssigned to: Autopilot\n\nExpectations:\n- Diagnose\
        \ root causes for the critic's repeated failures.\n- Patch critic configuration,\
        \ training data, or underlying automation as needed.\n- Document findings\
        \ in state/context.md and roadmap notes.\n- Close this task once the critic\
        \ passes reliably.\n\nLatest output snippet:\nwarning: The top-level linter\
        \ settings are deprecated in favour of their counterparts in the `lint` section.\
        \ Please update the following options in `pyproject.toml`:\n  - 'select' ->\
        \ 'lint.select'"
    - id: CRIT-PERF-INTEGRATIONFURY-9401af
      title: '[Critic:integrationfury] Restore performance'
      status: pending
      dependencies: []
      exit_criteria: []
      domain: product
      description: 'Critic integrationfury is underperforming and needs immediate
        remediation.


        Identity: Integration Fury (integration_fury, authority advisory)

        Mission: Safeguard integration_fury discipline.

        Signature powers: Reports on findings when configuration is missing.


        No successful runs recorded in the last 6 observations; 6 consecutive failures
        detected.


        Observation window: 6 runs


        Consecutive failures: 6


        Failures: 6 | Successes: 0


        Assigned to: Director Dana


        Expectations:

        - Diagnose root causes for the critic''s repeated failures.

        - Patch critic configuration, training data, or underlying automation as needed.

        - Document findings in state/context.md and roadmap notes.

        - Close this task once the critic passes reliably.


        Latest output snippet:

        ============================= test session starts ==============================

        platform darwin -- Python 3.10.12, pytest-8.4.2, pluggy-1.6.0

        rootdir: /Volumes/BigSSD4/nathanielschmiedehaus/Documents/WeatherVane

        configfile: pyproject.toml

        plugins: anyio-4.11.0, asyncio-1.2.0

        asyncio: mode=strict, debug=False, asyncio_default_fixture_loop_scope=None,
        asyncio_default_test_loop_scope=function

        collected 242 items


        tests/api/onboarding/test_progress.py ....                               [  1%]

        tests/api/test_ad_push_routes.py ....                                    [  3%]

        tests/api/test_dashboa...'
    - id: CRIT-PERF-MANAGERSELFCHECK-61ab48
      title: '[Critic:managerselfcheck] Restore performance'
      status: pending
      dependencies: []
      exit_criteria: []
      domain: product
      description: 'Critic managerselfcheck is underperforming and needs immediate
        remediation.


        Identity: Manager Self Check (manager_self_check, authority advisory)

        Mission: Safeguard manager_self_check discipline.

        Signature powers: Reports on findings when configuration is missing.


        No successful runs recorded in the last 6 observations; 6 consecutive failures
        detected.


        Observation window: 6 runs


        Consecutive failures: 6


        Failures: 6 | Successes: 0


        Assigned to: Director Dana


        Expectations:

        - Diagnose root causes for the critic''s repeated failures.

        - Patch critic configuration, training data, or underlying automation as needed.

        - Document findings in state/context.md and roadmap notes.

        - Close this task once the critic passes reliably.


        Latest output snippet:

        Rollback simulation stale (simulated_at=2025-10-15T21:05:00+00:00); rerun
        executor to refresh promotion gate.'
    - id: CRIT-PERF-ORGPM-be2140
      title: '[Critic:orgpm] Restore performance'
      status: pending
      dependencies: []
      exit_criteria: []
      domain: product
      description: 'Critic orgpm is underperforming and needs immediate remediation.


        Identity: Org Pm (org_pm, authority advisory)

        Mission: Safeguard org_pm discipline.

        Signature powers: Reports on findings when configuration is missing.


        Critic orgpm failed 5 of the last 6 runs with 0 consecutive failures.


        Observation window: 6 runs


        Consecutive failures: 0


        Failures: 5 | Successes: 1


        Assigned to: Autopilot


        Expectations:

        - Diagnose root causes for the critic''s repeated failures.

        - Patch critic configuration, training data, or underlying automation as needed.

        - Document findings in state/context.md and roadmap notes.

        - Close this task once the critic passes reliably.


        Latest output snippet:

        Org PM charter/state checks passed.'
    - id: CRIT-PERF-PROMPTBUDGET-2c30f3
      title: '[Critic:promptbudget] Restore performance'
      status: pending
      dependencies: []
      exit_criteria: []
      domain: product
      description: 'Critic promptbudget is underperforming and needs immediate remediation.


        Identity: Prompt Budget (prompt_budget, authority advisory)

        Mission: Safeguard prompt_budget discipline.

        Signature powers: Reports on findings when configuration is missing.


        Critic promptbudget failed 5 of the last 6 runs with 0 consecutive failures.


        Observation window: 6 runs


        Consecutive failures: 0


        Failures: 5 | Successes: 1


        Assigned to: Autopilot


        Expectations:

        - Diagnose root causes for the critic''s repeated failures.

        - Patch critic configuration, training data, or underlying automation as needed.

        - Document findings in state/context.md and roadmap notes.

        - Close this task once the critic passes reliably.


        Latest output snippet:

        {"level":"warning","message":"Code search index rebuild failed","timestamp":"2025-10-16T20:39:47.650Z","error":"The
        database connection is not open"}'
    - id: CRIT-PERF-TESTS-426598
      title: '[Critic:tests] Restore performance'
      status: pending
      dependencies: []
      exit_criteria: []
      domain: product
      description: "Critic tests is underperforming and needs immediate remediation.\n\
        \nIdentity: Regression Hunter (quality, authority blocking)\nMission: Keep\
        \ the test suites healthy and ensure deterministic results across flows.\n\
        Signature powers: Surfaces flaky suites and failing assertions with reproduction\
        \ notes.; Synthesizes minimal repro commands for Autopilot triage.\nAutonomy\
        \ guidance: Rerun targeted suites automatically; lean on Autopilot only when\
        \ new failures persist.\n\nCritic tests failed 5 of the last 6 runs with 0\
        \ consecutive failures.\n\nObservation window: 6 runs\n\nConsecutive failures:\
        \ 0\n\nFailures: 5 | Successes: 1\n\nAssigned to: Autopilot\n\nExpectations:\n\
        - Diagnose root causes for the critic's repeated failures.\n- Patch critic\
        \ configuration, training data, or underlying automation as needed.\n- Document\
        \ findings in state/context.md and roadmap notes.\n- Close this task once\
        \ the critic passes reliably.\n\nLatest output snippet:\n\e[33mThe CJS build\
        \ of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated\
        \ for more details.\e[39m\n{\"level\":\"info\",\"message\":\"Subscription\
        \ limit tracker initialized\",\"timestamp\":\"2025-10-16T21:37:34.835Z\",\"\
        providers\":[]}\n{\"level\":\"info\",\"message\":\"Provider registered for\
        \ usage tracking\",\"timestamp\":\"2025-10-16T21:37:34.837Z\",\"provider\"\
        :\"claude\",\"account\":\"test-account\",\"tier\":\"pro\"}\n{\"level\":\"\
        info\",\"message\":\"Subscription limit tracker stopped\",\"timestamp\":\"\
        2025-10-16T21:37:34.840Z\"}\n{\"level\":\"info\",\"message\":\"Subscription\
        \ limit tracker ..."
    - id: PHASE-1-HARDENING
      title: 'Phase 1: MCP Hardening'
      status: done
      dependencies: []
      exit_criteria: []
      domain: product
      description: "BLOCKING \u2013 must complete before other work (disable YAML\
        \ writes, real usage/cost, correlation IDs, coordinator failover)"
    - id: PHASE-2-COMPACT
      title: 'Phase 2: Compact Prompts + Selfchecks'
      status: done
      dependencies: []
      exit_criteria: []
      domain: product
      description: "BLOCKING \u2013 must complete before other work (compact context\
        \ assembler, snapshot selfcheck)"
    - id: PHASE-3-BATCH
      title: 'Phase 3: Batch Queue & Prompt Headers'
      status: done
      dependencies: []
      exit_criteria: []
      domain: product
      description: "BLOCKING \u2013 must complete before other work (batch queue,\
        \ stable headers, token heuristics)"
    - id: TASK-RESEARCH-DEMO
      title: 'Research: evaluate cache warming pattern'
      status: pending
      dependencies: []
      exit_criteria: []
      domain: product
      description: Investigate academic cache warming strategies and summarize findings
        for orchestration upgrades.
    - id: TASK-RESEARCH-SWEEP
      title: Research backlog sweep
      status: pending
      dependencies: []
      exit_criteria: []
      domain: product
      description: Identify high-impact roadmap areas lacking research coverage and
        propose follow-up research tasks.
- id: E1
  title: "Epic 1 \u2014 Ingest & Weather Foundations"
  status: done
  domain: product
  milestones:
  - id: M1.1
    title: Connector scaffolding
    status: done
    tasks:
    - id: T1.1.1
      title: Design Open-Meteo + Shopify connectors and data contracts
      status: done
      dependencies: []
      exit_criteria:
      - critic:build
      - critic:tests
      - doc:docs/INGESTION.md
      domain: product
    - id: T1.1.2
      title: Implement ingestion Prefect flow with checkpointing
      status: done
      dependencies:
      - T1.1.1
      exit_criteria:
      - critic:data_quality
      - critic:org_pm
      - artifact:experiments/ingest/dq_report.json
      domain: product
  - id: M1.2
    title: Weather harmonisation
    status: done
    tasks:
    - id: T1.2.1
      title: Blend historical + forecast weather, enforce timezone alignment
      status: done
      dependencies: []
      exit_criteria:
      - critic:forecast_stitch
      - doc:docs/weather/blending.md
      domain: product
    - id: T1.2.2
      title: Add leakage guardrails to feature builder
      status: done
      dependencies:
      - T1.2.1
      exit_criteria:
      - critic:leakage
      - critic:tests
      domain: product
  description: Stand up weather + marketing ingestion, harmonise geo/time, and validate
    data quality.
- id: E10
  title: "PHASE-6-COST \u2014 Usage-Based Optimisations"
  status: blocked
  domain: mcp
  milestones:
  - id: M10.1
    title: Usage telemetry & guardrails
    status: done
    tasks:
    - id: T10.1.1
      title: Cost telemetry and budget alerts
      status: done
      dependencies: []
      exit_criteria:
      - Provider cost telemetry recorded in state/telemetry/operations.jsonl
      - Budget thresholds configurable per environment
      - Alert surfaced via state/context.md and orchestration logs
      domain: mcp
  description: Cash-cost guardrails, budgeting telemetry, and API usage controls.
    Activate once we exit the subscription sandbox.
- id: E11
  title: Resource-Aware Intelligence & Personalisation
  status: blocked
  domain: product
  milestones:
  - id: M11.1
    title: Capability Detection
    status: done
    tasks:
    - id: T11.1.1
      title: Implement hardware probe & profile persistence
      status: done
      dependencies: []
      exit_criteria:
      - critic:build
      - doc:docs/ROADMAP.md
      domain: product
    - id: T11.1.2
      title: Adaptive scheduling for heavy tasks
      status: done
      dependencies: []
      exit_criteria:
      - critic:tests
      - artifact:state/device_profiles.json
      domain: product
  - id: M11.2
    title: Falcon Design System & Award-ready UX
    status: blocked
    tasks:
    - id: T11.2.1
      title: Design system elevation (motion, typography, theming)
      status: blocked
      dependencies: []
      exit_criteria:
      - critic:design_system
      - doc:docs/WEB_DESIGN_SYSTEM.md
      domain: product
    - id: T11.2.2
      title: Award-level experience audit & remediation
      status: in_progress
      dependencies: []
      exit_criteria:
      - critic:exec_review
      - artifact:docs/UX_CRITIQUE.md
      domain: product
    - id: T11.2.3
      title: Extend calm/aero theme tokens to Automations and Experiments surfaces
      status: blocked
      dependencies: []
      exit_criteria:
      - artifact:apps/web/styles/themes/calm.ts
      - artifact:apps/web/styles/themes/aero.ts
      - critic:design_system
      domain: product
    - id: T11.2.4
      title: Refactor landing/marketing gradients into reusable tokens
      status: blocked
      dependencies: []
      exit_criteria:
      - artifact:apps/web/styles/tokens/gradients.md
      - critic:design_system
      domain: product
    - id: T11.2.5
      title: Centralize retry button styles in shared component once App Router lands
      status: blocked
      dependencies: []
      exit_criteria:
      - artifact:apps/web/components/buttons/RetryButton.tsx
      - unknown
      - critic:design_system
      domain: product
    - id: T11.2.6
      title: Formalize shared panel mixin (border + shadow) to reduce overrides
      status: blocked
      dependencies: []
      exit_criteria:
      - artifact:apps/web/styles/mixins/panel.css
      - critic:design_system
      domain: product
  description: Auto-detect hardware, adapt workloads, and guarantee great performance
    on constrained machines.
- id: E2
  title: "Epic 2 \u2014 Features & Modeling Baseline"
  status: done
  domain: product
  milestones:
  - id: M2.1
    title: Feature pipeline
    status: done
    tasks:
    - id: T2.1.1
      title: Build lag/rolling feature generators with deterministic seeds
      status: done
      dependencies: []
      exit_criteria:
      - critic:build
      - critic:tests
      - critic:data_quality
      domain: product
  - id: M2.2
    title: Baseline modeling
    status: done
    tasks:
    - id: T2.2.1
      title: Train weather-aware GAM baseline and document methodology
      status: done
      dependencies: []
      exit_criteria:
      - critic:causal
      - critic:academic_rigor
      - doc:docs/models/baseline.md
      domain: product
  description: Ship lagged features, baseline models, and evaluation harness.
- id: E3
  title: "Epic 3 \u2014 Allocation & UX"
  status: blocked
  domain: product
  milestones:
  - id: M3.1
    title: Allocator guardrails
    status: done
    tasks:
    - id: T3.1.1
      title: Implement budget allocator stress tests and regret bounds
      status: done
      dependencies: []
      exit_criteria:
      - critic:allocator
      - critic:cost_perf
      - artifact:experiments/policy/regret.json
      domain: product
  - id: M3.2
    title: Dashboard + UX review
    status: done
    tasks:
    - id: T3.2.1
      title: Run design system critic and ensure accessibility coverage
      status: done
      dependencies: []
      exit_criteria:
      - critic:design_system
      domain: product
    - id: T3.2.2
      title: Elevate dashboard storytelling & UX
      status: done
      dependencies: []
      exit_criteria:
      - critic:design_system
      - critic:exec_review
      - doc:docs/UX_CRITIQUE.md
      - artifact:docs/product/UX_CRITIQUE.md
      domain: product
  - id: M3.3
    title: Autonomous Orchestration Blueprints
    status: pending
    tasks:
    - id: T3.3.1
      title: Draft multi-agent charter & delegation mesh (AutoGen/Swarm patterns)
      status: done
      dependencies: []
      exit_criteria:
      - artifact:docs/orchestration/multi_agent_charter.md
      - critic:manager_self_check
      - critic:org_pm
      domain: product
    - id: T3.3.2
      title: Implement hierarchical consensus & escalation engine
      status: pending
      dependencies:
      - T3.3.1
      exit_criteria:
      - critic:integration_fury
      - critic:manager_self_check
      - doc:docs/orchestration/consensus_engine.md
      domain: product
    - id: T3.3.3
      title: Build closed-loop simulation harness for autonomous teams
      status: pending
      dependencies:
      - T3.3.2
      exit_criteria:
      - artifact:experiments/orchestration/simulation_report.md
      - critic:tests
      - critic:health_check
      domain: product
    - id: T3.3.4
      title: Instrument dynamic staffing telemetry & learning pipeline
      status: pending
      dependencies:
      - T3.3.3
      exit_criteria:
      - critic:prompt_budget
      - critic:exec_review
      - artifact:state/analytics/orchestration_metrics.json
      domain: product
  - id: M3.4
    title: Experience Implementation
    status: blocked
    tasks:
    - id: T3.4.1
      title: Implement Plan overview page with weather-driven insights
      status: done
      dependencies:
      - T3.3.3
      exit_criteria:
      - artifact:apps/web/pages/plan.tsx
      - unknown
      - critic:design_system
      domain: product
    - id: T3.4.2
      title: Build WeatherOps dashboard with allocator + weather KPIs
      status: done
      dependencies:
      - T3.3.3
      exit_criteria:
      - artifact:apps/web/pages/dashboard.tsx
      - unknown
      - critic:design_system
      domain: product
    - id: T3.4.3
      title: Ship Experiments hub UI for uplift & incrementality reviews
      status: pending
      dependencies:
      - T3.3.3
      exit_criteria:
      - artifact:apps/web/pages/experiments.tsx
      - unknown
      - critic:design_system
      domain: product
    - id: T3.4.4
      title: Deliver storytelling Reports view with weather + spend narratives
      status: pending
      dependencies:
      - T3.3.4
      exit_criteria:
      - artifact:apps/web/pages/reports.tsx
      - unknown
      - critic:design_system
      domain: product
    - id: T3.4.5
      title: Conduct design_system + UX acceptance review across implemented pages
      status: blocked
      dependencies:
      - T3.4.1
      - T3.4.2
      - T3.4.3
      - T3.4.4
      exit_criteria:
      - critic:design_system
      - doc:docs/product/acceptance_report.md
      - artifact:state/critics/designsystem.json
      domain: product
  description: Allocator robustness checks, dashboards, and UI polish.
- id: E4
  title: "Epic 4 \u2014 Operational Excellence"
  status: pending
  domain: product
  milestones:
  - id: M4.1
    title: Optimization sprint
    status: pending
    tasks:
    - id: T4.1.10
      title: Cross-market saturation optimization (fairness-aware)
      status: pending
      dependencies: []
      exit_criteria:
      - critic:allocator
      - artifact:experiments/allocator/saturation_report.json
      domain: product
    - id: T4.1.3
      title: Causal uplift modeling & incremental lift validation
      status: done
      dependencies: []
      exit_criteria:
      - critic:causal
      - artifact:experiments/causal/uplift_report.json
      domain: product
    - id: T4.1.4
      title: Multi-horizon ensemble forecasting
      status: done
      dependencies: []
      exit_criteria:
      - critic:forecast_stitch
      - artifact:experiments/forecast/ensemble_metrics.json
      domain: product
    - id: T4.1.5
      title: Non-linear allocation optimizer with constraints (ROAS, spend caps)
      status: done
      dependencies: []
      exit_criteria:
      - critic:allocator
      - unknown
      domain: product
    - id: T4.1.6
      title: High-frequency spend response modeling (intraday adjustments)
      status: done
      dependencies: []
      exit_criteria:
      - critic:allocator
      - artifact:experiments/allocator/hf_response.json
      domain: product
    - id: T4.1.7
      title: Marketing mix budget solver (multi-channel, weather-aware)
      status: done
      dependencies: []
      exit_criteria:
      - critic:allocator
      - unknown
      domain: product
    - id: T4.1.8
      title: Reinforcement-learning shadow mode (safe exploration)
      status: pending
      dependencies: []
      exit_criteria:
      - critic:allocator
      - artifact:experiments/rl/shadow_mode.json
      domain: product
    - id: T4.1.9
      title: Creative-level response modeling with brand safety guardrails
      status: pending
      dependencies: []
      exit_criteria:
      - critic:design_system
      - artifact:experiments/creative/response_scores.json
      domain: product
  description: Maintain velocity while hardening performance and delivery processes.
- id: E5
  title: Ad Platform Execution & Automation
  status: blocked
  domain: product
  milestones:
  - id: M5.1
    title: Meta Ads Command Pipeline
    status: pending
    tasks:
    - id: T5.1.1
      title: Implement Meta Marketing API client (creative + campaign management)
      status: pending
      dependencies: []
      exit_criteria:
      - critic:allocator
      - unknown
      domain: product
    - id: T5.1.2
      title: Meta sandbox and dry-run executor with credential vaulting
      status: pending
      dependencies: []
      exit_criteria:
      - critic:security
      - artifact:experiments/meta/sandbox_run.json
      domain: product
  - id: M5.2
    title: Google Ads Execution & Budget Sync
    status: pending
    tasks:
    - id: T5.2.1
      title: Google Ads API integration (campaign create/update, shared budgets)
      status: pending
      dependencies: []
      exit_criteria:
      - critic:allocator
      - unknown
      domain: product
    - id: T5.2.2
      title: Budget reconciliation & spend guardrails across platforms
      status: pending
      dependencies: []
      exit_criteria:
      - critic:allocator
      - artifact:experiments/allocator/spend_guardrails.json
      domain: product
  - id: M5.3
    title: QA, Rollback & Safety Harness
    status: done
    tasks:
    - id: T5.3.1
      title: Dry-run & diff visualizer for ad pushes (pre-flight checks)
      status: done
      dependencies: []
      exit_criteria:
      - critic:tests
      - artifact:state/ad_push_diffs.json
      domain: product
    - id: T5.3.2
      title: Automated rollback + alerting when performance/regression detected
      status: done
      dependencies: []
      exit_criteria:
      - critic:manager_self_check
      - artifact:experiments/allocator/rollback_sim.json
      domain: product
  description: Enable WeatherVane to programmatically create, update, monitor, and
    rollback ads across major platforms.
- id: E6
  title: MCP Orchestrator Production Readiness
  status: blocked
  domain: mcp
  milestones:
  - id: M6.1
    title: Core Infrastructure Validation
    status: done
    tasks:
    - id: T6.1.1
      title: MCP server integration tests (all 25 tools across both providers)
      status: done
      dependencies: []
      exit_criteria:
      - critic:tests
      - artifact:tests/test_mcp_tools.py
      - 'Guardrail: integration suite enforces blue/green safety invariants (no unhandled
        throws, DRY_RUN parity)'
      domain: mcp
    - id: T6.1.2
      title: Provider failover testing (token limit simulation & automatic switching)
      status: done
      dependencies: []
      exit_criteria:
      - critic:manager_self_check
      - artifact:experiments/mcp/failover_test.json
      - 'Guardrail: circuit-breaker rollback and DISABLE_NEW kill switch verified
        under simulated failures'
      domain: mcp
    - id: T6.1.3
      title: State persistence testing (checkpoint recovery across sessions)
      status: done
      dependencies: []
      exit_criteria:
      - critic:tests
      - artifact:tests/test_state_persistence.py
      - 'Guardrail: recovery flow preserves upgrade locks and safety state without
        manual intervention'
      domain: mcp
    - id: T6.1.4
      title: Quality framework validation (10 dimensions operational)
      status: done
      dependencies: []
      exit_criteria:
      - critic:manager_self_check
      - artifact:state/quality/assessment_log.json
      - 'Guardrail: quality checks confirm run-safety metrics from blue/green playbook
        remain green'
      domain: mcp
  - id: M6.2
    title: Security & Reliability Hardening
    status: blocked
    tasks:
    - id: T6.2.1
      title: Credentials security audit (auth.json, API keys, token rotation)
      status: blocked
      dependencies: []
      exit_criteria:
      - critic:security
      - doc:docs/SECURITY_AUDIT.md
      - 'Guardrail: audit verifies secrets handling inside blue/green upgrade flow
        and DRY_RUN constraints'
      domain: mcp
    - id: T6.2.2
      title: Error recovery testing (graceful degradation, retry logic)
      status: done
      dependencies: []
      exit_criteria:
      - critic:tests
      - artifact:experiments/mcp/error_recovery.json
      - 'Guardrail: automated rollback path exercised with observation window + DISABLE_NEW
        reset'
      domain: mcp
    - id: T6.2.3
      title: Schema validation enforcement (all data contracts validated)
      status: blocked
      dependencies: []
      exit_criteria:
      - critic:data_quality
      - artifact:shared/contracts/*.schema.json
      - 'Guardrail: dual-write / expand-cutover-contract workflow logged for 100%
        safe migrations'
      domain: mcp
    - id: T6.2.4
      title: API rate limiting & exponential backoff (Open-Meteo, Shopify, Ads APIs)
      status: blocked
      dependencies: []
      exit_criteria:
      - critic:allocator
      - unknown
      - 'Guardrail: rate-limit handling respects worker timeouts and prevents cascading
        failures during upgrades'
      domain: mcp
  - id: M6.3
    title: Observability & Performance
    status: done
    tasks:
    - id: T6.3.1
      title: Performance benchmarking (MCP overhead, checkpoint size, token usage)
      status: done
      dependencies: []
      exit_criteria:
      - critic:cost_perf
      - artifact:experiments/mcp/performance_benchmarks.json
      - 'Guardrail: benchmarks include worker swap scenarios and confirm resource
        limits (timeouts, RSS) hold'
      domain: mcp
    - id: T6.3.2
      title: Enhanced observability export (structured logs, metrics dashboards)
      status: done
      dependencies: []
      exit_criteria:
      - critic:manager_self_check
      - artifact:state/telemetry/metrics_summary.json
      - "Guardrail: telemetry captures Step 0\u201315 safety signals with alerting\
        \ on breaches"
      domain: mcp
    - id: T6.3.3
      title: Autopilot loop end-to-end testing (full autonomous cycle validation)
      status: done
      dependencies: []
      exit_criteria:
      - critic:manager_self_check
      - artifact:experiments/mcp/autopilot_e2e.json
      - 'Guardrail: autonomous loop validates automatic promotion + rollback without
        manual resets'
      domain: mcp
  - id: M6.4
    title: Zero-downtime self-upgrade
    status: blocked
    tasks:
    - id: T6.4.0
      title: Upgrade invariants & preflight guardrails
      status: blocked
      dependencies: []
      exit_criteria:
      - state/upgrade.lock created before work and removed on exit
      - "Preflight script validates git status, Node/npm versions, disk \u2265500MB,\
        \ sandbox availability"
      - Four-step gate recorded in logs; any failure returns {error:"upgrade_aborted"}
      domain: mcp
      description: "Define upgrade preflight: clean git, version sanity, \u2265500MB\
        \ disk, SQLite lock probe, and single-flight upgrade.lock. Gate promotion\
        \ through build \u2192 unit \u2192 selfchecks \u2192 canary, aborting with\
        \ {error:\"upgrade_aborted\"} on any failure."
    - id: T6.4.1
      title: Live feature flag store with kill switch
      status: done
      dependencies: []
      exit_criteria:
      - settings table created with defaults + DISABLE_NEW
      - LiveFlags poller refreshes in-memory cache during runtime
      - Integration test flips PROMPT_MODE without restart
      domain: mcp
      description: "Replace environment toggles with a SQLite-backed `settings` table,\
        \ seed\ndefaults, and hot-refresh cached flags (\u2264500 ms poll). Include\
        \ a\n`DISABLE_NEW` global kill switch that forces legacy behaviour instantly.\n"
    - id: T6.4.2
      title: Blue/green worker manager & front-end proxy
      status: blocked
      dependencies: []
      exit_criteria:
      - WorkerManager exposes startActive/startCanary/switchToCanary
      - Front-end tool handlers call workers.getActive().call(...)
      - RPC protocol enforces ready handshake, 30s timeouts, and structured {ok,error}
        results
      - Test demonstrates zero-downtime swap between worker binaries
      domain: mcp
      description: 'Keep the MCP front-end process stable while managing active and
        canary

        worker children over IPC. Ensure requests route through a proxy that can

        atomically switch to the validated canary without disconnecting clients.

        '
    - id: T6.4.3
      title: Worker entrypoint with DRY_RUN safeguards
      status: blocked
      dependencies: []
      exit_criteria:
      - Route function covers health/plan/dispatch/runTool/verify/report.mo
      - SQLite opened via file:state/state.db?mode=ro when DRY_RUN=1
      - applyPatch/mutate operations rejected while DRY_RUN=1
      - tests/test_worker_dry_run.py captures read-only guarantees
      domain: mcp
      description: 'Implement a dedicated worker entry that routes RPCs, enforces
        DRY_RUN=1

        by opening the state DB read-only, refuses mutating calls, and confirms

        legacy behaviour when DRY_RUN=0.

        '
    - id: T6.4.4
      title: Canary upgrade harness & shadow validation
      status: blocked
      dependencies: []
      exit_criteria:
      - scripts/mcp_safe_upgrade.sh orchestrates worktree build + tests
      - Shadow checks compare active vs canary outputs in logs
      - "Promotion flow documents gate order and staged routing (DRY \u2192 live)\
        \ with metrics snapshots"
      - experiments/mcp/upgrade/<ts>/report.json recorded for each run
      domain: mcp
      description: 'Automate the upgrade flow: create a separate git worktree, build/test
        new

        code, spawn a DRY_RUN canary, run shadow health/plan/report checks, then

        promote only if outputs match expectations.

        '
    - id: T6.4.5
      title: Feature flag gating for compact prompts & sandbox pool
      status: blocked
      dependencies: []
      exit_criteria:
      - PROMPT_MODE, SANDBOX_MODE, SCHEDULER_MODE, SELECTIVE_TESTS, DANGER_GATES,
        MO_ENGINE read from LiveFlags
      - Regression fixtures cover legacy vs new mode per feature
      - docs/MCP_ORCHESTRATOR.md updated with flag toggle order
      domain: mcp
      description: 'Gate compact prompt headers, sandbox pooling, scheduler WSJF mode,

        selective tests, danger gates, and MO engine behind live flags so they

        only activate after successful canary validation.

        '
    - id: T6.4.6
      title: Runtime tool registration & admin flag controls
      status: blocked
      dependencies: []
      exit_criteria:
      - Tool handlers return 'disabled' until corresponding flag enabled
      - settings.update, upgrade.applyPatch, route.switch commands exposed with structured
        errors
      - Operator guide added under docs/MCP_AUTOMATION.md#live-flags
      domain: mcp
      description: 'Ensure tool surfaces remain stable while routing to v1/v2 handlers
        based

        on flags. Provide an MCP admin tool or CLI to update settings atomically

        without restarts.

        '
    - id: T6.4.7
      title: Automatic rollback monitors & kill-switch reset
      status: blocked
      dependencies: []
      exit_criteria:
      - Heartbeat every 2s with 3-strike circuit breaker routes back to standby
      - Error budget (5%/2min) and SLO monitors trigger automatic rollback
      - DISABLE_NEW flag automatically flipped during rollback
      - docs/MCP_ORCHESTRATOR.md includes rollback playbook
      domain: mcp
      description: 'Add health monitoring that reverts to the previous worker and
        resets

        flags when error rates spike post-promotion. Document on-call rollback

        steps and ensure DISABLE_NEW restores legacy behaviour.

        '
    - id: T6.4.8
      title: Observability & resource budgets during upgrade
      status: blocked
      dependencies: []
      exit_criteria:
      - Span/log attributes include method, lane, ok/error, duration, task.id
      - runTool/plan timeouts (30s/120s) & lane concurrency limits enforced
      - RSS watchdog throttles batch lane when >1.5x baseline
      domain: mcp
      description: 'Emit OTel spans (or structured JSON logs) for every worker call
        with

        timing, lane, task, and outcome metadata. Enforce concurrency, timeout,

        and RSS guards to prevent runaway resource usage.

        '
    - id: T6.4.9
      title: Post-switch self-check automation & staged flag flips
      status: blocked
      dependencies: []
      exit_criteria:
      - "Self-check script loops through health, plan\u2192dispatch, repo.read, tests.run,\
        \ report.mo"
      - Determinism checks gate each flag; any failure auto-resets to legacy
      - Observation window metrics recorded and linked in experiments/mcp/upgrade/
      - On success, upgrade.applyPatch clears state/upgrade.lock and commits new flags
        as default without manual intervention
      domain: mcp
      description: 'Automate the 10-minute observation window, deterministic checks
        per

        feature, final flip order, and self-check suite (health, plan, dispatch,

        repo, tests, report) with rollback on breach.

        '
  description: Validate and harden the dual-provider MCP orchestrator for autonomous
    operation while preserving 100% run safety. All milestones under this epic must
    enforce the blue/green upgrade guardrails defined in docs/MCP_ORCHESTRATOR.md#1113-tight-integration-playbook-steps-0-15.
- id: E7
  title: Data Pipeline Hardening
  status: blocked
  domain: product
  milestones:
  - id: M7.1
    title: Geocoding & Weather Integration
    status: done
    tasks:
    - id: T7.1.1
      title: Complete geocoding integration (city->lat/lon, cache strategy)
      status: done
      dependencies: []
      exit_criteria:
      - critic:data_quality
      - unknown
      domain: product
    - id: T7.1.2
      title: Weather feature join to model matrix (prevent future leakage)
      status: done
      dependencies: []
      exit_criteria:
      - critic:leakage
      - artifact:experiments/features/weather_join_validation.json
      domain: product
    - id: T7.1.3
      title: Data contract schema validation (Shopify, weather, ads)
      status: done
      dependencies: []
      exit_criteria:
      - critic:data_quality
      - unknown
      domain: product
  - id: M7.2
    title: Pipeline Robustness
    status: blocked
    tasks:
    - id: T7.2.1
      title: Incremental ingestion with deduplication & checkpointing
      status: blocked
      dependencies: []
      exit_criteria:
      - critic:data_quality
      - unknown
      domain: product
    - id: T7.2.2
      title: Data quality monitoring & alerting (anomaly detection)
      status: blocked
      dependencies: []
      exit_criteria:
      - critic:data_quality
      - artifact:state/dq_monitoring.json
      domain: product
  description: Complete geocoding integration, weather feature joins, and data quality
    validation.
- id: E8
  title: "PHASE-4-POLISH \u2014 MCP Production Hardening"
  status: done
  domain: mcp
  milestones:
  - id: M8.1
    title: MCP Compliance & Security
    status: done
    tasks:
    - id: T8.1.1
      title: 'Lock MCP schemas to Zod shapes (SAFE: guardrail)'
      status: done
      dependencies: []
      exit_criteria:
      - utils/schema.ts returns schema.shape with guardrail comment
      - MCP entrypoints register raw shapes only
      - Autopilot documentation updated to reflect guardrail
      - critic:build passes
      - 'Guardrail: validation confirms schema handling does not weaken blue/green
        safety gates'
      domain: mcp
    - id: T8.1.2
      title: 'Implement command allow-list in guardrails (SAFE: additive security)'
      status: done
      dependencies: []
      exit_criteria:
      - ALLOWED_COMMANDS constant defined
      - isCommandAllowed() enforced before execution
      - Deny-list kept as secondary check
      - critic:tests passes with new test_command_allowlist.py
      - critic:manager_self_check passes
      - 'Guardrail: allow-list integration verified against blue/green upgrade scenarios'
      domain: mcp
    - id: T8.1.3
      title: 'Thread correlation IDs through state transitions (SAFE: observability
        only)'
      status: done
      dependencies: []
      exit_criteria:
      - All tool handlers generate correlationId
      - All state transitions include correlationId
      - Events in SQLite include correlation_id column populated
      - critic:manager_self_check passes
      - End-to-end trace visible in state/orchestrator.db
      - "Guardrail: correlation IDs trace compliance with Step 0\u201315 safety checks"
      domain: mcp
  - id: M8.2
    title: Context & Performance Optimization
    status: done
    tasks:
    - id: T8.2.1
      title: 'Implement compact evidence-pack prompt mode (SAFE: new function, backward
        compatible)'
      status: done
      dependencies: []
      exit_criteria:
      - formatForPromptCompact() returns JSON evidence pack
      - unknown
      - All coordinator calls use compact mode
      - critic:build passes
      - critic:manager_self_check passes
      - unknown
      - 'Guardrail: compact mode flip integrated with Step 15 staged flag process'
      domain: mcp
    - id: T8.2.2
      title: "Finalize Claude\u2194Codex coordinator failover (SAFE: expose existing\
        \ functionality)"
      status: done
      dependencies: []
      exit_criteria:
      - orchestrator_status tool shows coordinator type and availability
      - Telemetry includes coordinator field in execution logs
      - Documentation updated in IMPLEMENTATION_STATUS.md
      - critic:manager_self_check passes
      - Failover behavior visible and logged
      - 'Guardrail: failover reporting feeds SLO/error budget monitors for auto rollback'
      domain: mcp
  description: "Critical production readiness tasks for MCP orchestrator. Complete\
    \ before WeatherVane v1 launch while maintaining the Step 0\u201315 run-safety\
    \ guardrails (docs/MCP_ORCHESTRATOR.md#1113-tight-integration-playbook-steps-0-15)."
- id: E9
  title: "PHASE-5-OPTIMIZATION \u2014 Performance & Observability"
  status: blocked
  domain: mcp
  milestones:
  - id: M9.1
    title: Cost Optimization & Caching
    status: blocked
    tasks:
    - id: T9.1.1
      title: 'Stable prompt headers with provider caching (SAFE: additive optimization)'
      status: done
      dependencies: []
      exit_criteria:
      - standardPromptHeader() returns deterministic header
      - All prompts include standard header
      - Header enables provider caching (verified with API logs)
      - critic:cost_perf shows token cache hit rate
      - critic:manager_self_check passes
      - "Guardrail: caching rollout assessed via Step 0\u201315 safety checks before\
        \ staying live"
      domain: mcp
    - id: T9.1.2
      title: 'Batch queue for non-urgent prompts (SAFE: new queueing system)'
      status: blocked
      dependencies: []
      exit_criteria:
      - Priority queue with 3 lanes operational
      - Semaphore limits enforced per lane
      - Interactive tasks always get priority
      - critic:tests passes
      - critic:manager_self_check passes
      - 'Guardrail: queue respects worker concurrency caps from blue/green playbook'
      domain: mcp
  - id: M9.2
    title: Reliability & Quality Improvements
    status: blocked
    tasks:
    - id: T9.2.1
      title: 'Strict output DSL validation (SAFE: validation layer only)'
      status: blocked
      dependencies: []
      exit_criteria:
      - validateDiff() rejects non-diff outputs
      - validateJSON() rejects invalid JSON
      - Retry rate reduction measured
      - critic:tests passes
      - 'Guardrail: validation enforced in canary shadow runs before live promotion'
      domain: mcp
    - id: T9.2.2
      title: 'Idempotency keys for mutating tools (SAFE: caching layer)'
      status: blocked
      dependencies: []
      exit_criteria:
      - Idempotency cache operational
      - Duplicate operations return cached results
      - 1-hour TTL enforced
      - critic:tests passes
      - 'Guardrail: cache respects DRY_RUN mode and avoids side effects during canary
        runs'
      domain: mcp
  - id: M9.3
    title: Production Observability
    status: blocked
    tasks:
    - id: T9.3.1
      title: 'OpenTelemetry spans for all operations (SAFE: tracing wrapper)'
      status: blocked
      dependencies: []
      exit_criteria:
      - All tool handlers instrumented
      - Spans exported to tracing backend
      - End-to-end traces visible
      - Performance insights available
      - critic:manager_self_check passes
      - "Guardrail: telemetry alerts on Step 0\u201315 safety breaches"
      domain: mcp
    - id: T9.3.2
      title: 'Sandbox pooling for test execution (SAFE: new executor)'
      status: blocked
      dependencies:
      - E5
      exit_criteria:
      - Sandbox pool with 3 pre-warmed containers
      - Test execution uses pooled sandboxes
      - 10x speedup measured
      - Fallback to non-pooled works
      - critic:tests passes
      - 'Guardrail: pool enforces DRY_RUN read-only mode during canary validation'
      domain: mcp
  - id: M9.4
    title: Advanced Context & Search
    status: blocked
    tasks:
    - id: T9.4.1
      title: 'SQLite FTS5 index for code search (SAFE: new index)'
      status: blocked
      dependencies:
      - E5
      exit_criteria:
      - code_fts virtual table created
      - Index populated on repo sync
      - Search performance <50ms
      - critic:tests passes
      domain: mcp
    - id: T9.4.2
      title: 'LSP proxy tools for symbol-aware context (SAFE: new tools)'
      status: blocked
      dependencies: []
      exit_criteria:
      - tsserver and pyright proxies running
      - lsp.definition and lsp.references tools work
      - Context assembler uses LSP for code slices
      - Context relevance measured and improved
      - critic:tests passes
      - "Guardrail: LSP tools routed through worker proxy with Step 0\u201315 safety\
        \ enforcement"
      domain: mcp
  description: Post-v1 performance improvements and production observability. High
    ROI optimizations that still honour the blue/green guardrail contract.
